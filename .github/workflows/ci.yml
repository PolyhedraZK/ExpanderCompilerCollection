name: ci

on: [push, pull_request]

env:
  RUSTFLAGS: "-Dwarnings"
  RUST_BACKTRACE: 1

jobs:
  test-rust-avx512:
    runs-on: 7950x3d
    steps:
      - uses: styfle/cancel-workflow-action@0.11.0
      - uses: actions/checkout@v4
      - uses: dtolnay/rust-toolchain@stable
      - uses: Swatinem/rust-cache@v2
        with:
          workspaces: "expander_compiler -> expander_compiler/target"
          # The prefix cache key, this can be changed to start a new cache manually.
          prefix-key: "mpi-v5.0.5" # update me if brew formula changes to a new version
      - run: RUSTFLAGS="-C target-cpu=native -C target-feature=+avx512f" cargo test
